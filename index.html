<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Self-driving car AI using neuroevolution (genetic algorithm + neural network) built with p5.js and TensorFlow.js." />
    <title>AI Self-Driving Car â€“ Neuroevolution</title>

    <!-- p5.js â€“ rendering & main loop -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>

    <!-- TensorFlow.js â€“ neural network inference -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>

    <!-- Map data generated by pista.py -->
    <script src="mapa_gerado.js"></script>

    <!-- Project classes -->
    <script src="brain.js"></script>
    <script src="car.js"></script>
    <script src="sketch.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet" />

    <style>
      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

      :root {
        --bg:        #0d0d12;
        --surface:   #14141e;
        --border:    #222236;
        --accent:    #6c63ff;
        --accent2:   #ff8c42;
        --green:     #00e676;
        --red:       #ff5252;
        --text:      #e0e0f0;
        --muted:     #7070a0;
        --radius:    10px;
      }

      html, body {
        height: 100%;
        background: var(--bg);
        color: var(--text);
        font-family: 'Inter', sans-serif;
      }

      body {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        gap: 20px;
        padding: 24px;
        min-height: 100vh;
      }

      /* â”€â”€ Canvas wrapper â”€â”€ */
      #canvas-wrap {
        flex-shrink: 0;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: 0 8px 40px rgba(108,99,255,.25);
      }

      canvas { display: block; }

      /* â”€â”€ Sidebar â”€â”€ */
      #hud {
        width: 240px;
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        gap: 14px;
      }

      .hud-title {
        font-size: 17px;
        font-weight: 700;
        color: var(--accent);
        letter-spacing: .5px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 10px;
      }

      .card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 14px 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .card-label {
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--muted);
        margin-bottom: 2px;
      }

      .stat {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .stat-name { font-size: 13px; color: var(--muted); }

      .stat-value {
        font-family: 'JetBrains Mono', monospace;
        font-size: 15px;
        font-weight: 600;
        color: var(--text);
      }

      .stat-value.accent  { color: var(--accent); }
      .stat-value.accent2 { color: var(--accent2); }
      .stat-value.green   { color: var(--green); }

      /* Progress bar for alive/total */
      .progress-wrap {
        background: var(--border);
        border-radius: 999px;
        height: 6px;
        overflow: hidden;
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--accent), var(--accent2));
        border-radius: 999px;
        transition: width .3s ease;
      }

      /* â”€â”€ Keyboard shortcuts â”€â”€ */
      .shortcuts {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .shortcut {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 12px;
      }
      .kbd {
        background: var(--border);
        color: var(--text);
        font-family: 'JetBrains Mono', monospace;
        font-size: 11px;
        border-radius: 4px;
        padding: 2px 7px;
        border: 1px solid #3a3a5a;
      }
      .shortcut-desc { color: var(--muted); }

      /* â”€â”€ Buttons â”€â”€ */
      .btn-row { display: flex; gap: 8px; }
      button {
        flex: 1;
        padding: 9px 0;
        border: none;
        border-radius: 7px;
        font-family: 'Inter', sans-serif;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: opacity .2s, transform .1s;
      }
      button:active { transform: scale(.97); opacity: .85; }
      .btn-save { background: var(--accent); color: #fff; }
      .btn-load { background: var(--accent2); color: #fff; }
      .btn-reset { background: var(--red); color: #fff; }

      /* toast */
      #toast {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%) translateY(60px);
        background: #1e1e35;
        border: 1px solid var(--accent);
        color: var(--text);
        font-size: 13px;
        padding: 10px 20px;
        border-radius: 999px;
        pointer-events: none;
        opacity: 0;
        transition: opacity .25s, transform .3s;
      }
      #toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    </style>
  </head>

  <body>
    <div id="canvas-wrap"></div>

    <aside id="hud">
      <div class="hud-title">ðŸš— Neuroevolution Drive</div>

      <!-- Evolution stats -->
      <div class="card">
        <span class="card-label">Evolution</span>
        <div class="stat">
          <span class="stat-name">Generation</span>
          <span class="stat-value accent" id="hud-gen">1</span>
        </div>
        <div class="stat">
          <span class="stat-name">Frame</span>
          <span class="stat-value" id="hud-time">0</span>
        </div>
        <div class="stat">
          <span class="stat-name">Speed</span>
          <span class="stat-value accent2" id="hud-fps">60 FPS</span>
        </div>
      </div>

      <!-- Population -->
      <div class="card">
        <span class="card-label">Population</span>
        <div class="stat">
          <span class="stat-name">Alive</span>
          <span class="stat-value green" id="hud-alive">30</span>
        </div>
        <div class="stat">
          <span class="stat-name">Total</span>
          <span class="stat-value" id="hud-total">30</span>
        </div>
        <div class="progress-wrap">
          <div class="progress-bar" id="hud-bar" style="width:100%"></div>
        </div>
      </div>

      <!-- Scores -->
      <div class="card">
        <span class="card-label">Score</span>
        <div class="stat">
          <span class="stat-name">Best (ever)</span>
          <span class="stat-value accent" id="hud-best-ever">0</span>
        </div>
        <div class="stat">
          <span class="stat-name">Leader now</span>
          <span class="stat-value accent2" id="hud-leader">0</span>
        </div>
        <div class="stat">
          <span class="stat-name">Finishers</span>
          <span class="stat-value green" id="hud-finished">0</span>
        </div>
      </div>

      <!-- Brain persistence -->
      <div class="card">
        <span class="card-label">Brain</span>
        <div class="btn-row">
          <button class="btn-save" onclick="salvarCerebro()">ðŸ’¾ Save</button>
          <button class="btn-load" onclick="carregarCerebro()">ðŸ“‚ Load</button>
        </div>
        <button class="btn-reset" onclick="resetarTudo()">ðŸ”„ Reset</button>
      </div>

      <!-- Keyboard shortcuts -->
      <div class="card">
        <span class="card-label">Shortcuts</span>
        <div class="shortcuts">
          <div class="shortcut"><span class="kbd">S</span><span class="shortcut-desc">Save best brain</span></div>
          <div class="shortcut"><span class="kbd">L</span><span class="shortcut-desc">Load brain</span></div>
          <div class="shortcut"><span class="kbd">R</span><span class="shortcut-desc">Reset simulation</span></div>
          <div class="shortcut"><span class="kbd">+</span><span class="shortcut-desc">Speed up</span></div>
          <div class="shortcut"><span class="kbd">âˆ’</span><span class="shortcut-desc">Slow down</span></div>
        </div>
      </div>
    </aside>

    <div id="toast"></div>
  </body>
</html>